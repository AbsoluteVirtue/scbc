<!DOCTYPE html>

<head>
    <!-- <link rel="icon" type="image/png" href="./static/favicon.png" /> -->

    <style>
        table {
            width: 75%;
            padding: 2;
            border: 0;
            margin-left: auto;
            margin-right: auto;
        }

        td {
            border: 1px solid;
            text-align: center;
            vertical-align: middle;
        }

        .tcell {
            text-align: left;
        }
    </style>
</head>

<body>
    <div class="container" id="bottom">
    </div>

    <!-- <script>
        fetch('db.json').then(response => response.json()).then(data => {console.log(data)})
    </script> -->
    <script type="text/javascript" src="./db.js"></script>
    <script type="text/javascript" src="./tr.js"></script>

    <script>
        const ARMOR_CLASSES = ["combat", "research", "clothes", "combined", "scientific"];
        const WEAPON_CLASSES = ["ar", "melee", "pistol", "shotgun", "lr", "smg", "mg", "heavy"];

        const CATEGORIES = ["weapons", "armor"];
        const CLASS_DICT = {
            "armor": ARMOR_CLASSES,
            "weapons": WEAPON_CLASSES
        };
    </script>

    <script>
        document.body.onload = addElement;

        const language = "ru"; // TODO: add language picker

        function addElement() {
            const currentDiv = document.getElementById("bottom");

            for (const [category, items] of Object.entries(data)) {
                if (category != "armor") continue; // TODO: add proper category filter

                const table = document.createElement("table");

                const head = table.createTHead();
                const r = head.insertRow();
                r.innerHTML = LANG[language][category];

                const body = table.createTBody();

                let class_picker = CLASS_DICT[category]; // TODO: filter out classes based on active buttons

                const classes = CLASS_DICT[category].filter(item => class_picker.includes(item));
                const filtered_items = items.filter(item => classes.includes(item["class"]));

                for (const item of filtered_items) {
                    const tr = body.insertRow();

                    const name = tr.insertCell();
                    name.innerHTML = LANG[language][item["id"]];

                    const pic = tr.insertCell();
                    pic_url = `assets/icons/${category}/${item["class"]}/${item["exboid"]}.png`;
                    pic.innerHTML = `<img src="${pic_url}"/>`

                    const bonus = tr.insertCell();

                    var str_bonus = "";
                    for (const [k, v] of Object.entries(item["bonus"])) {
                        str_bonus += `<div class="tcell">${LANG[language][k]}: ${v}</div>`;
                    }
                    bonus.innerHTML = str_bonus;

                    const stats = tr.insertCell();
                    var str_stats = "";
                    for (const [k, v] of Object.entries(item["stats"])) {
                        str_stats += `<div class="tcell">${LANG[language][k]}: ${v}</div>`;
                    }
                    stats.innerHTML = str_stats;

                    const cost = tr.insertCell();
                    var str_cost = "";
                    for (const [k, v] of Object.entries(item["cost"])) {
                        str_cost += `<div class="tcell">${LANG[language][k]}: ${v}</div>`;
                    }
                    cost.innerHTML = str_cost;
                }

                document.body.insertBefore(table, currentDiv);
            }
        }
    </script>
</body>